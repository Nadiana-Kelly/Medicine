<!doctype html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Medicine</title>
      
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <link  rel="stylesheet" type="text/css" href="main.css">
  </head>
  <body>
    <!-- Header -->
    <header>
        <nav>
            <img class="logo" src="logo.png" width="254px" height="54px" alt="logo">
            <div class="nav-list d-flex align-items-center justify-content-center">
                <div class="dropdown">
                    <button class="btn border acessib-cor dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        ACESSIBILIDADE
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li class="m-0"><a class="dropdown-item item1" href="#" onclick="aumentarFonte(event)">A+</a></li>
                        <li class="m-0"><a class="dropdown-item item2" href="#" onclick="diminuirFonte(event)">A-</a></li>
                        <li class="m-0"><a class="dropdown-item item3" href="#" id="btnColor">ALTERAR TEMA</a></li>
                    </ul>
                </div>

                <a id="registro" href="../tela8-consultasMedico/index.html" class="text-white ms-4 mb-0 font-header">PROFISSIONAIS</a>
                <a class="linha-verical ms-3"></a>
                <a id="login" href="../tela0-login/index.html" class="text-white ms-4 mb-0 font-header outline-marker">LOGOUT</a>
            </div>
        </nav>
    </header>

    <!-- corpo -->
    <main class="d-flex justify-content-center h-auto">
        <div class="col-10 mt-xl-5">
            <div class="col-12">
                <h1 class="text-left"> Gerenciamento de Profissionais </h1>
            </div>

            <div class="col-6">
                <p class="text-left font"> Adicione ou remova profissionais cadastrados no sistema
                    do <strong>Medicine</strong>. Para cadastrar um novo profisional aperte no botão abaixo
                    e siga os passos do formulário. </p>
            </div>

            <div>
                <button class="btn btn-primary btn-adicprof rounded-5 p-0 ps-4" style="z-index: 1;"> ADICIONAR PROFISSIONAL </button>
                <img src="icone1.svg" class="btnadic" style="z-index: 2;">
            </div>

            <div class="d-flex mt-lg-5 col-12">
                <h1 class="col-6"> Profissionais cadastrados </h1>
                <div class="col-6 d-flex flex-row-reverse">
                    <div class="mt-2 d-flex justify-content-end flex-row-reverse">
                        <input type="text" class="form-control rounded-5 buscar" style="z-index: 1;" placeholder="Buscar.." oninput="filter(event)"/> 
                        <img src="image4.svg" class="lupa" style="z-index: 2;">
                    </div>
                </div>
            </div>

            <div class="content-distance mb-5" id="content">

                <!-- <div class="mt-5">
                    <div class="border-2 shadow rounded d-flex align-items-center caixa-medico">
                        <img src="medico1.png" alt="algum erro" width="150px" height="150px" class="rounded-circle mt-2 mb-2 ms-4">
                        <div class="ms-3 col-6">
                            <strong class="fs-5"> Dra. Juliana Brasil </strong>
                        </div>

                        <div class="w-100 d-flex flex-row-reverse">
                            <button class="btn btn-primary  rounded-5 btn-remover"> REMOVER PROFISSIONAL </button>
                        </div>
                    </div>
                </div>

                <div class="mt-5">
                    <div class="border-2 shadow rounded d-flex align-items-center caixa-medico">
                        <img src="medico2.png" alt="algum erro" width="150px" height="150px" class="rounded-circle mt-2 mb-2 ms-4">
                        <div class="ms-3 col-6">
                            <strong class="fs-5"> Dr. Flávio Ferreira </strong>
                        </div>

                        <div class="w-100 d-flex flex-row-reverse">
                            <button class="btn btn-primary  rounded-5 btn-remover"> REMOVER PROFISSIONAL </button>
                        </div>
                    </div>
                </div> -->
            </div>

        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="../HeaderFooter/scriptColor.js"> </script>
    
    <script>
        function aumentarFonte() {
            var fontSize = parseInt(localStorage.getItem('fontSize')) || 16;
            if (fontSize <= 20){
                fontSize += 2;
            }
            console.log(fontSize);
            document.documentElement.style.fontSize = fontSize + 'px';
            localStorage.setItem('fontSize', fontSize);
        }

        // Função para diminuir o tamanho da fonte
        function diminuirFonte() {
            var fontSize = parseInt(localStorage.getItem('fontSize')) || 16;
        
            if (fontSize >= 16){
                fontSize -= 2;
            }
            console.log(fontSize);
            document.documentElement.style.fontSize = fontSize + 'px';
            localStorage.setItem('fontSize', fontSize);
        }

        // Aplicar o tamanho de fonte armazenado no carregamento da página
        var fontSize = parseInt(localStorage.getItem('fontSize')) || 16;
        document.documentElement.style.fontSize = fontSize + 'px';

        const url = 'http://localhost:3011/listarMedicos';

        const medicosHTML = [];

        fetch(url)
        .then(res => {
            if(res.ok) {
                return res.json();
            } else {
                throw new Error("Falha na requisição. Código de status: " + response.status);
            }
        })
        .then(res => {
            let content = document.getElementById('content');
            const medicosIds = [];

            for(medico of res) {
                const html = `<div class="mt-5" id='medico${medico.id}'>` +
                        '<div class="border-2 shadow rounded d-flex align-items-center caixa-medico">' +
                            `<img src='${medico.foto}' alt=${medico.nome} width='150px' height='150px' class="rounded-circle mt-2 mb-2 ms-4">` +
                            '<div class="ms-3 col-6">'+
                                `<strong class="fs-5"> ${medico.nome} </strong>` +
                            '</div>'+
                            '<div class="w-100 d-flex flex-row-reverse">'+
                                `<button class="btn btn-primary rounded-5 btn-remover" id='botao${medico.id}'> REMOVER PROFISSIONAL </button>` +
                            '</div>'+
                        '</div>'+
                    '</div>';

                content.innerHTML += html;

                medicosHTML.push({
                        name: medico.nome,
                        html,
                        buttonId: 'botao'+medico.id
                    }
                );

                medicosIds.push('botao'+medico.id);
            }

            medicosIds.forEach((value) => {
                document.getElementById(value).addEventListener('click', function(event) {
                    const target = event.target;
                    const medicoId = event.target.id.substring(event.target.id.indexOf('botao')+5);

                    const url = `http://localhost:3011/apagarMedico/${medicoId}`;

                    fetch(url, { method: "DELETE" }).then(res => {
                        if(res.ok) {
                            const medicoHTML = document.getElementById(`medico${medicoId}`);
                            medicoHTML.remove();
                            alert('Medico removido.');
                        } else {
                            alert('Algum erro ocorreu.');
                        }
                    }).catch(err => {
                        alert('Algum erro ocorreu');
                    });
                });
            });
        });

        function filter(event) {
            const text = event.target.value.toLowerCase();
            const filtered = [];

            medicosHTML.forEach((value) => {
                if(value.name.toLowerCase().startsWith(text)) {
                    console.log(value.name);
                    filtered.push([value.html, value.buttonId]);
                }
            });

            const content = document.getElementById('content');
            content.innerHTML = '';

            filtered.forEach((value) => {
                content.innerHTML += value[0];
            });

            filtered.forEach((value) => {
                document.getElementById(value[1]).addEventListener('click', function(event) {
                        const target    = event.target;
                        const medicoId  = event.target.id.substring(event.target.id.indexOf('botao')+5);

                        const url = `http://localhost:3011/apagarMedico/${medicoId}`;

                        fetch(url, { method: "DELETE" }).then(res => {
                            if(res.ok) {
                                const medicoHTML = document.getElementById(`medico${medicoId}`);
                                medicoHTML.remove();
                                alert('Medico removido.');
                            } else {
                                alert('Algum erro ocorreu.');
                            }
                        }).catch(err => {
                            alert('Algum erro ocorreu');
                        });
                    });
            });
        }   

    </script>
  </body>
</html>

